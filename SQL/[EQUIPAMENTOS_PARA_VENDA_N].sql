

ALTER VIEW [dbo].[EQUIPAMENTOS_PARA_VENDA_N]
AS
SELECT      dbo.TB02054.TB02054_CODEMP AS EMPRESA,
			dbo.TB01010.TB01010_REFERENCIA AS REFERENCIA,
			dbo.TB01010.TB01010_RESUMIDO AS RESUMIDO,
			dbo.TB02054.TB02054_NUMSERIE AS SERIAL,
			dbo.TB02054.TB02054_QTPROD - TB02054_QTPRODS AS QUANTIDADE,
			dbo.TB02054.TB02054_DTVALIDADE AS VALIDADE,
			dbo.TB01096.TB01096_NOME AS SITUACAO,
			dbo.TB01096.TB01096_CODIGO AS CODSITUACAO,
			dbo.TB02054.TB02054_LOCSER AS LOCAL,
			dbo.TB01003.TB01003_NOME AS NOMELOCAL,
			dbo.TB02054.TB02054_TIPOCON AS TIPO,
			dbo.TB02054.TB02054_PRODUTO,
			dbo.TB01010.TB01010_NOME AS EQUIPAMENTO,
			dbo.TB02054.TB02054_OBS AS OBS,
			dbo.TB02054.TB02054_PONTUACAO AS PONTUACAO,
			dbo.TB02054.TB02054_MEDIDORTOTAL AS MEDIDORTOTAL,
			dbo.TB02054.TB02054_MEDIDORPB AS MEDIDORPB,
			dbo.TB02054.TB02054_MEDIDORCOLOR AS MEDIDORCOLOR,
			dbo.TB02054.TB02054_STATUS AS CODSTATUS,
			dbo.TB02115.TB02115_CODIGO AS OS,
			dbo.TB01073.TB01073_NOME AS STATUSOS,
			TB01047_NOME AS MARCA,
			TB02002_NCONTEINER  AS CONTAINER,
			TB02002_DATA AS DATAPREVISAO,
			TB01110_VENDAP as VALORBASE,
			TB02054_FATOR AS FATOR,
			(TB01110_VENDA * TB02054_FATOR) AS VALORFINAL,
			TB02054_CUSTO AS CUSTOSERIAL,
			TB02130_DATA AS DATAMOVOS,
			TB01010_SUBGRUPO AS SUBGRUPO,
			TB01110_IPI/100 AS IPI,
			TB01010_CODIGO AS CODPRODUTO,
			dbo.TB02115.TB02115_CODCLI AS CODCLI

FROM            dbo.TB02054 LEFT OUTER JOIN

                         dbo.TB01096 ON dbo.TB01096.TB01096_CODIGO = dbo.TB02054.TB02054_STATUS LEFT OUTER JOIN
                         dbo.TB01003 ON dbo.TB01003.TB01003_CODIGO = dbo.TB02054.TB02054_LOCPPROD LEFT OUTER JOIN
                         dbo.TB01010 ON dbo.TB01010.TB01010_CODIGO = dbo.TB02054.TB02054_PRODUTO LEFT OUTER JOIN
						 dbo.TB01110 ON dbo.TB01110.TB01110_PRODUTO = dbo.TB01010.TB01010_CODIGO AND TB01110_CODEMP = '00' LEFT OUTER JOIN
						 TB01047 ON TB01047_CODIGO = TB01010_MARCA LEFT JOIN 
                         dbo.TB02115 ON dbo.TB02115.TB02115_NUMSERIE = dbo.TB02054.TB02054_NUMSERIE AND dbo.TB02115.TB02115_PRODUTO = dbo.TB02054.TB02054_PRODUTO AND dbo.TB02115.TB02115_CODEMP = dbo.TB02054.TB02054_CODEMP AND dbo.TB02115.TB02115_DTFECHA IS NULL LEFT OUTER JOIN
                         dbo.TB01073 ON dbo.TB01073.TB01073_CODIGO = dbo.TB02115.TB02115_STATUS LEFT JOIN
						 TB02130 ON TB02130_CODIGO = TB02115_CODIGO AND TB02130_TIPO = 'O' AND TB02130_STATUS = TB02115_STATUS AND TB02130_CODEMP IN ('00','80') LEFT JOIN
						 
						
						 TB02002 ON TB02002_CODIGO = (SELECT TOP 1 TB02055_CODIGO FROM TB02055 WHERE TB02055_NUMSERIE = TB02054_NUMSERIE AND TB02055_PRODUTO = TB02054_PRODUTO AND TB02055_TABELA = 'TB02002' ORDER BY TB02055_CODIGO DESC) and TB02002_NESTOQUE = 'N'

WHERE        (dbo.TB02054.TB02054_QTPROD - dbo.TB02054.TB02054_QTPRODS > 0) AND (dbo.TB02054.TB02054_IMOB = 'N') AND TB02054_RMA < 1 AND (dbo.TB01010.TB01010_TIPOSUP = '9' OR
                         dbo.TB01010.TB01010_TIPOSUP = '11')
GO


